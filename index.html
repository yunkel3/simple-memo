<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ã‚·ãƒ³ãƒ—ãƒ«ãƒ¡ãƒ¢</title>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
<style>
  body {
    margin:0; font-family:sans-serif; color:#333; background:#f4f4f4;
    display:flex; flex-direction:column; min-height:100vh;
    transition:background .3s,color .3s; touch-action: manipulation;
    padding-bottom: calc(40px + env(safe-area-inset-bottom)); /* ãƒ•ãƒƒã‚¿ãƒ¼ã®é«˜ã• + ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢ã®ä½™ç™½ */
  }
  body.dark-mode { background:#333; color:#f4f4f4; }
  h1 {
    margin:0; padding:15px 0; text-align:center; background:#fff;
    box-shadow:0 2px 5px rgba(0,0,0,.1); color:#4caf50; flex-shrink:0;
  }
  body.dark-mode h1 { background:#555; color:#76ff03; }

  /* ãƒ•ãƒƒã‚¿ãƒ¼ã¨ã—ã¦ãƒœã‚¿ãƒ³ã‚’å›ºå®š */
  footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    background:#f9f9f9;
    box-shadow:0 -2px 5px rgba(0,0,0,.05); /* ä¸Šæ–¹å‘ã«å½± */
    flex-shrink:0;
    padding: 10px 0; /* ãƒœã‚¿ãƒ³ã®ä¸Šä¸‹ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
    padding-bottom: calc(10px + env(safe-area-inset-bottom)); /* ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢ã®ä½™ç™½ã‚’è¿½åŠ  */
    z-index: 1000; /* ä»–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚ˆã‚Šæ‰‹å‰ã«è¡¨ç¤º */
  }
  body.dark-mode footer { background:#444; }

  button {
    flex:1; padding:0; /* ãƒ•ãƒƒã‚¿ãƒ¼ã§ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æŒãŸã›ã‚‹ã®ã§ãƒœã‚¿ãƒ³è‡ªä½“ã¯0 */
    font-size:16px; border:none; background:transparent;
    position:relative; cursor:pointer; color:inherit; overflow:hidden;
    touch-action: manipulation; user-select:none;
  }
  button:not(:last-child) { border-right:1px solid #ccc; }
  .action-button:not(:last-child) { border-color:#007bff; }
  .utility-button:not(:last-child) { border-color:#6c757d; }
  .danger-button:not(:last-child) { border-color:#dc3545; }

  /* æ–°ã—ã„ inactive ã‚¹ã‚¿ã‚¤ãƒ« */
  button.inactive {
    opacity: 0.5; /* åŠé€æ˜ã«ã™ã‚‹ */
    cursor: default; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã™ã‚‹ï¼ˆä»»æ„ï¼‰ */
  }

  .anim-bg {
    position:absolute; top:0; left:0; width:100%; height:100%;
    transform: translateX(-100%); animation:slideRight .5s ease forwards; z-index:0;
  }
  @keyframes slideRight { to { transform: translateX(100%); } }
  .action-button .anim-bg { background:#007bff; }
  .utility-button .anim-bg { background:#6c757d; }
  .danger-button .anim-bg { background:#dc3545; }

  .material-symbols-outlined {
    font-size:24px; vertical-align:middle;
  }

  textarea {
    width:100%; padding:20px; font-size:18px; line-height:1.5;
    border:none; resize:none; outline:none; flex-grow: 1; /* æ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ */
    box-sizing:border-box; background:#fff; color:#333;
    overflow:hidden;
    min-height: calc(100vh - 80px - 200px - env(safe-area-inset-bottom)); /* ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ãƒƒã‚¿ãƒ¼ã‚’è€ƒæ…®ã—ãŸæœ€å°é«˜ã•ï¼ˆæš«å®šå€¤ï¼‰ */
    transition:background .3s,color .3s;
  }
  body.dark-mode textarea { background:#222; color:#f4f4f4; }
</style>
</head>
<body>
<h1>ğŸ“ï¸</h1>

<textarea id="memo" placeholder="ã“ã“ã«ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>

<footer>
  <button class="utility-button theme"><span class="material-symbols-outlined">light_mode</span></button>
  <button class="danger-button clear"><span class="material-symbols-outlined">delete</span></button>
  <button class="action-button copy">ã‚³ãƒ”ãƒ¼</button>
  <button class="action-button undo">â†æˆ»ã™</button>
  <button class="action-button redo">â†’æ¬¡ã¸</button>
</footer>

<script>
  const t=document.getElementById("memo");
  let undoStk=[],redoStk=[],restoring=false,lastVal="";

  const resize=()=>{ t.style.height="auto"; t.style.height=t.scrollHeight+"px"; };
  const persist=()=> {
    localStorage.memo=t.value;
    localStorage.undoStack=JSON.stringify(undoStk);
    localStorage.redoStack=JSON.stringify(redoStk);
  };

  // update é–¢æ•°ã‚’ä¿®æ­£: disabled ã®ä»£ã‚ã‚Šã« inactive ã‚¯ãƒ©ã‚¹ã‚’æ“ä½œ
  const update=()=> {
    const hasText=!!t.value;
    document.querySelectorAll(".undo").forEach(b=>b.classList.toggle("inactive", undoStk.length <= 1));
    document.querySelectorAll(".redo").forEach(b=>b.classList.toggle("inactive", !redoStk.length));
    document.querySelectorAll(".copy, .clear").forEach(b=>b.classList.toggle("inactive", !hasText));
  };

  const apply=v=>{
    restoring=true; t.value=lastVal=v; resize(); restoring=false; update(); persist();
  };
  const save=()=>{
    if(restoring||t.value===lastVal) return;
    undoStk.push(t.value); if(undoStk.length>1000) undoStk.shift();
    redoStk=[]; lastVal=t.value; update(); persist();
  };
  const animateBtn=btn=>{
    const anim=document.createElement("span");
    anim.className="anim-bg";
    btn.appendChild(anim);
    anim.addEventListener("animationend",()=>anim.remove());
  };

  window.onload=()=>{
    t.value=localStorage.memo||"";
    try{ undoStk=JSON.parse(localStorage.undoStack)||[t.value]; }catch{undoStk=[t.value];}
    try{ redoStk=JSON.parse(localStorage.redoStack)||[]; }catch{}
    if(undoStk.at(-1)!==t.value) undoStk.push(t.value);
    lastVal=t.value; resize(); update();

    const isDark=localStorage.theme==="dark";
    document.body.classList.toggle("dark-mode",isDark);
    document.querySelectorAll(".theme .material-symbols-outlined").forEach(i=> {
      i.textContent=isDark?"dark_mode":"light_mode";
    });
  };

  t.addEventListener("input",()=>{
    resize();
    if(/\s|\n/.test(t.value.slice(-1))) save();
    update();
  });

  for(const btn of document.querySelectorAll("button")){
    btn.addEventListener("pointerdown",e=>{ // ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆeã‚’å—ã‘å–ã‚‹
      e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‹•ä½œã‚’æŠ‘åˆ¶
      
      // ãƒœã‚¿ãƒ³ãŒ inactive ã§ãªã„å ´åˆã®ã¿ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã¾ãŸã¯å¸¸ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ãªã‚‰ã“ã®ifæ–‡ã¯ä¸è¦ï¼‰
      // ä»Šå›ã¯ inactive ã§ã‚‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ã®ã§ã€ã“ã® if ã¯å‰Šé™¤
      animateBtn(btn); // æ¡ä»¶ã«é–¢ã‚ã‚‰ãšã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯å®Ÿè¡Œ

      // å„ãƒœã‚¿ãƒ³ã®å‡¦ç†ã®å‰ã«æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
      if(btn.classList.contains("undo")){
        if(undoStk.length <= 1) return; // æ¡ä»¶ã‚’æº€ãŸã•ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
        if(t.value!==undoStk.at(-1)) redoStk.push(t.value);
        else redoStk.push(undoStk.pop());
        apply(undoStk.at(-1));
      } else if(btn.classList.contains("redo")){
        if(!redoStk.length) return; // æ¡ä»¶ã‚’æº€ãŸã•ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
        const v=redoStk.pop();
        undoStk.push(v);
        apply(v);
      } else if(btn.classList.contains("copy")){
        if(!t.value) return; // æ¡ä»¶ã‚’æº€ãŸã•ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
        navigator.clipboard.writeText(t.value).catch(()=>{});
      } else if(btn.classList.contains("clear")){
        if(!t.value) return; // æ¡ä»¶ã‚’æº€ãŸã•ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
        if(confirm("ãƒ¡ãƒ¢ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
          save(); t.value=""; redoStk=[]; apply("");
        }
      } else if(btn.classList.contains("theme")){
        const dark=document.body.classList.toggle("dark-mode");
        localStorage.theme=dark?"dark":"light";
        document.querySelectorAll(".theme .material-symbols-outlined").forEach(i=>{
          i.textContent=dark?"dark_mode":"light_mode";
        });
        resize();
      }
    });
    btn.ondblclick=e=>e.preventDefault();
  }
</script>
</body>
</html>
